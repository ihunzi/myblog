# tensorflow2åŸºç¡€

[TOC]

------

## æ•°æ®ç±»å‹
å‡ ä¹æ‰€æœ‰æ•°æ®éƒ½å¯ä»¥å«**å¼ é‡ï¼ˆtensorï¼‰**ï¼Œæ ¹æ®ç»´åº¦æ¥åŒºåˆ†ï¼Œå¯ä»¥åˆ†ä¸ºï¼š

- æ ‡é‡(Scalar)ã€‚å•ä¸ªçš„å®æ•°ï¼Œå¦‚1.2, 3.4 ç­‰ï¼Œç»´åº¦(Dimension)æ•°ä¸º0ï¼Œshape ä¸º[]ã€‚

- å‘é‡(Vector)ã€‚nä¸ªå®æ•°çš„æœ‰åºé›†åˆï¼Œé€šè¿‡ä¸­æ‹¬å·åŒ…è£¹ï¼Œå¦‚[1.2]ï¼Œ[1.2, 3.4]ç­‰ï¼Œç»´åº¦æ•°ä¸º1ï¼Œé•¿åº¦ä¸å®šï¼Œshape ä¸º[n]ã€‚

- çŸ©é˜µ(Matrix)ã€‚nè¡Œmåˆ—å®æ•°çš„æœ‰åºé›†åˆï¼Œå¦‚[[1,2], [3,4]]ï¼Œä¹Ÿå¯ä»¥å†™æˆ$\begin{bmatrix}1&2\\3&4\\\end{bmatrix}$ï¼Œç»´åº¦æ•°ä¸º2ï¼Œæ¯ä¸ªç»´åº¦ä¸Šçš„é•¿åº¦ä¸å®šï¼Œshape ä¸º[n, m]ã€‚

- å¼ é‡(Tensor)ã€‚æ‰€æœ‰ç»´åº¦æ•°dim > 2çš„æ•°ç»„ç»Ÿç§°ä¸ºå¼ é‡ã€‚å¼ é‡çš„æ¯ä¸ªç»´åº¦ä¹Ÿä½œè½´(Axis)ï¼Œä¸€èˆ¬ç»´åº¦ä»£è¡¨äº†å…·ä½“çš„ç‰©ç†å«ä¹‰ï¼Œæ¯”å¦‚Shape ä¸º[2, 32, 32, 3]çš„å¼ é‡å…±æœ‰4 ç»´ï¼Œå¦‚æœè¡¨ç¤ºå›¾ç‰‡æ•°æ®çš„è¯ï¼Œæ¯ä¸ªç»´åº¦/è½´ä»£è¡¨çš„å«ä¹‰åˆ†åˆ«æ˜¯å›¾ç‰‡æ•°é‡ã€å›¾ç‰‡é«˜åº¦ã€å›¾ç‰‡å®½åº¦ã€å›¾ç‰‡é€šé“æ•°ï¼Œå…¶ä¸­2 ä»£è¡¨äº†2 å¼ å›¾ç‰‡ï¼Œ32 ä»£è¡¨äº†é«˜ã€å®½å‡ä¸º32ï¼Œ3 ä»£è¡¨äº†RGB å…±3 ä¸ªé€šé“ã€‚å¼ é‡çš„ç»´åº¦æ•°ä»¥åŠæ¯ä¸ªç»´åº¦æ‰€ä»£è¡¨çš„å…·ä½“ç‰©ç†å«ä¹‰éœ€è¦ç”±ç”¨æˆ·è‡ªè¡Œå®šä¹‰ã€‚

>åœ¨ TensorFlow ä¸­é—´ï¼Œä¸ºäº†è¡¨è¾¾æ–¹ä¾¿ï¼Œä¸€èˆ¬æŠŠæ ‡é‡ã€å‘é‡ã€çŸ©é˜µä¹Ÿç»Ÿç§°ä¸ºå¼ é‡ï¼Œä¸ä½œåŒºåˆ†ï¼Œéœ€è¦æ ¹æ®å¼ é‡çš„ç»´åº¦æ•°æˆ–å½¢çŠ¶è‡ªè¡Œåˆ¤æ–­ï¼Œ

### åŸºæœ¬æ•°æ®ç±»å‹æœ‰
intã€floatã€double
bool ï¼ˆ0å’Œ1ã€trueå’Œfalseï¼‰
string


### é€šè¿‡TensorFlowçš„æ–¹å¼å»åˆ›å»ºå¼ é‡
å¦‚æœè¦ä½¿ç”¨TensorFlow æä¾›çš„åŠŸèƒ½å‡½æ•°ï¼Œé¡»é€šè¿‡TensorFlow è§„å®šçš„æ–¹å¼å»åˆ›å»ºå¼ é‡
- åˆ›å»ºæ ‡é‡
`tf.constant(1.2)`
![1195_1](https://gitee.com/ihunzi/images/raw/master/blog/1195_1.png)
id æ˜¯TensorFlow ä¸­å†…éƒ¨ç´¢å¼•å¯¹è±¡çš„ç¼–å·ï¼Œshape è¡¨ç¤ºå¼ é‡çš„å½¢çŠ¶ï¼Œdtype è¡¨ç¤ºå¼ é‡çš„æ•°å€¼ç²¾åº¦

### tensorå¸¸è§ä¸”æœ‰ç”¨çš„å±æ€§
* **x.device**
  è¿”å›å½“å‰tensoræ‰€åœ¨è®¾å¤‡çš„åå­—![1197_1](https://gitee.com/ihunzi/images/raw/master/blog/1197_1.png)

* **tensoråœ¨è®¾å¤‡ä¸Šçš„è½¬ç§»**
![1199_1 (1)](https://gitee.com/ihunzi/images/raw/master/blog/1199_1%20(1).png)

* **tensorè½¬numpy**
![1201_1](https://gitee.com/ihunzi/images/raw/master/blog/1201_1.png)

* **è¿”å›ç»´åº¦**
![1203_1](https://gitee.com/ihunzi/images/raw/master/blog/1203_1.png)

* **åˆ¤æ–­æ•°æ®æ˜¯å¦æ˜¯tensor**
![1205_1](https://gitee.com/ihunzi/images/raw/master/blog/1205_1.png)

* **åˆ¤æ–­æ•°æ®ç±»å‹**
![1207_1](https://gitee.com/ihunzi/images/raw/master/blog/1207_1.png)

* **numpyè½¬tensor**
    
    * convert_to_tensor
      
      ![1209_1](https://gitee.com/ihunzi/images/raw/master/blog/1209_1.png)
      
    * cast
    
      ![1211_1](https://gitee.com/ihunzi/images/raw/master/blog/1211_1.png)
    
      æ•´å½¢è½¬å¸ƒå°”å‹
    
      ![1213_1 (1)](https://gitee.com/ihunzi/images/raw/master/blog/1213_1%20(1).png)
    
* **tf.Variable**
ä¸ºäº†åŒºåˆ†éœ€è¦è®¡ç®—æ¢¯åº¦ä¿¡æ¯çš„å¼ é‡ä¸ä¸éœ€è¦è®¡ç®—æ¢¯åº¦ä¿¡æ¯çš„å¼ é‡ï¼ŒTensorFlow å¢åŠ äº†ä¸€ç§ä¸“é—¨çš„æ•°æ®ç±»å‹æ¥æ”¯æŒæ¢¯åº¦ä¿¡æ¯çš„è®°å½•ï¼štf.Variableã€‚tf.Variable ç±»å‹åœ¨æ™®é€šçš„å¼ é‡ç±»å‹åŸºç¡€ä¸Šæ·»åŠ äº†nameï¼Œtrainable ç­‰å±æ€§æ¥æ”¯æŒè®¡ç®—å›¾çš„æ„å»ºã€‚ç”±äºæ¢¯åº¦è¿ç®—ä¼šæ¶ˆè€—å¤§é‡çš„è®¡ç®—èµ„æºï¼Œè€Œä¸”ä¼šè‡ªåŠ¨æ›´æ–°ç›¸å…³å‚æ•°ï¼Œå¯¹äºä¸éœ€è¦çš„ä¼˜åŒ–çš„å¼ é‡ï¼Œå¦‚ç¥ç»ç½‘ç»œçš„è¾“å…¥**X**ï¼Œä¸éœ€è¦é€šè¿‡tf.Variable å°è£…ï¼›ç›¸åï¼Œå¯¹äºéœ€è¦è®¡ç®—æ¢¯åº¦å¹¶ä¼˜åŒ–çš„å¼ é‡ï¼Œå¦‚ç¥ç»ç½‘ç»œå±‚çš„**w**å’Œ**b**ï¼Œéœ€è¦é€šè¿‡tf.Variable åŒ…è£¹ä»¥ä¾¿TensorFlow è·Ÿè¸ªç›¸å…³æ¢¯åº¦ä¿¡æ¯ã€‚
![1215_1](https://gitee.com/ihunzi/images/raw/master/blog/1215_1.png)

------

## åˆ›å»ºtensor

### ä»Numpyã€Liståˆ›å»º

`tf.convert_to_tensor()`

`tf.constant`

è¿™ä¸¤ä¸ªæ–¹æ³•åŠŸèƒ½åŸºæœ¬ä¸€æ ·

![image-20210805190857361](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805190857361.png)

![image-20210805191019225](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805191019225.png)

### åˆ›å»ºå…¨0\å…¨1å¼ é‡

`tf.zeros()`

![image-20210805191431371](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805191431371.png)

`tf.ones()`

![image-20210805191715140](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805191715140.png)

`tf.zeros_like()`å’Œ`tf.ones_like()`

åˆ›å»ºä¸€ä¸ªå’Œä¼ å…¥å‚æ•°shapeç›¸åŒçš„å…¨0\å…¨1å¼ é‡

![image-20210805192211037](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805192211037.png)

### åˆ›å»ºå…¨è‡ªå®šä¹‰æ•°å€¼å¼ é‡

`tf.fill`

é™¤äº†åˆå§‹åŒ–ä¸ºå…¨0ï¼Œæˆ–å…¨1 çš„å¼ é‡ä¹‹å¤–ï¼Œæœ‰æ—¶ä¹Ÿéœ€è¦å…¨éƒ¨åˆå§‹åŒ–ä¸ºæŸä¸ªè‡ªå®šä¹‰æ•°å€¼çš„å¼ é‡ï¼Œæ¯”å¦‚å°†å¼ é‡çš„æ•°å€¼å…¨éƒ¨åˆå§‹åŒ–ä¸ºâˆ’1ç­‰ã€‚

åˆ›å»ºæ‰€æœ‰å…ƒç´ ä¸º-1 çš„å‘é‡ï¼š

![image-20210805192418011](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805192418011.png)

### éšæœºåˆå§‹åŒ–

* æ­£æ€åˆ†å¸ƒNormal Distribution

`tf.random.normal`

![image-20210805193133838](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805193133838.png)

å‡å€¼ä¸º`mean`ï¼Œæ ‡å‡†å·®ä¸º`stddev`ï¼Œä¸è®¾ç½®è¿™ä¸¤ä¸ªå‚æ•°é»˜è®¤ä¸º0å’Œ1

**æˆªæ–­çš„æ­£æ€åˆ†å¸ƒ**

`tf.random.truncated_normal`

è¿™ä¸ªåˆå§‹åŒ–ç”¨æ¥é¿å…æ¢¯åº¦å¼¥æ•£ï¼Œæ•ˆæœå¯èƒ½ä¼šæ¯”tf.random.normalæ›´å¥½ä¸€ç‚¹

![image-20210805193335728](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805193335728.png)

* å‡åŒ€åˆ†å¸ƒUniform Distribution

`tf.random.uniform`

åˆ›å»ºé‡‡æ ·è‡ª[minval, maxval)åŒºé—´çš„å‡åŒ€åˆ†å¸ƒçš„å¼ é‡ã€‚ä¾‹å¦‚åˆ›å»ºé‡‡æ ·è‡ªåŒºé—´[0,1)ï¼Œshape ä¸º[2,2]çš„çŸ©é˜µ

![image-20210805193723622](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805193723622.png)

å¦‚æœéœ€è¦å‡åŒ€é‡‡æ ·æ•´å½¢ç±»å‹çš„æ•°æ®ï¼Œå¿…é¡»æŒ‡å®šé‡‡æ ·åŒºé—´çš„æœ€å¤§å€¼maxval å‚æ•°ï¼ŒåŒæ—¶æŒ‡å®šæ•°æ®ç±»å‹ä¸ºtf.int*å‹

![image-20210805193918938](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805193918938.png)

### åˆ›å»ºä¸€æ®µè¿ç»­çš„æ•´å‹åºåˆ—

`tf.range()`

tf.range(start, limit, delta=1)å¯ä»¥åˆ›å»º[0, limit)ä¹‹é—´ï¼Œæ­¥é•¿ä¸ºdelta çš„æ•´å‹åºåˆ—ï¼Œä¸åŒ…å«limit æœ¬èº«ï¼Œstartä¸º0æ—¶å¯çœç•¥ã€‚

![image-20210805200054691](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805200054691.png)

------

## å¼ é‡çš„å…¸å‹åº”ç”¨

### æ ‡é‡ Scalar

æ ‡é‡æœ€å®¹æ˜“ç†è§£ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªç®€å•çš„æ•°å­—ï¼Œç»´åº¦æ•°ä¸º0ï¼Œshape ä¸º[]

* []
* `Loss` æŸå¤±å€¼
* `Accuracy` å‡†ç¡®åº¦

### å‘é‡ Vector

å‘é‡æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ•°æ®è½½ä½“ï¼Œå¦‚åœ¨å…¨è¿æ¥å±‚å’Œå·ç§¯ç¥ç»ç½‘ç»œå±‚ä¸­(y=x@w+b)ï¼Œåç½®å¼ é‡ğ’ƒå°±ä½¿ç”¨å‘é‡æ¥è¡¨ç¤ºã€‚

### çŸ©é˜µ Matrix

çŸ©é˜µä¹Ÿæ˜¯éå¸¸å¸¸è§çš„å¼ é‡ç±»å‹ï¼Œæ¯”å¦‚å…¨è¿æ¥å±‚çš„æ‰¹é‡è¾“å…¥å¼ é‡ğ‘¿çš„å½¢çŠ¶ä¸º[ğ‘, $ğ‘‘_{in}$]ï¼Œå…¶ä¸­ğ‘è¡¨ç¤ºè¾“å…¥æ ·æœ¬çš„ä¸ªæ•°ï¼Œå³Batch Sizeï¼›$ğ‘‘_{in}$â€‹è¡¨ç¤ºè¾“å…¥ç‰¹å¾çš„é•¿åº¦ã€‚

### ä¸‰ç»´å¼ é‡

ä¸‰ç»´çš„å¼ é‡ä¸€ä¸ªå…¸å‹åº”ç”¨æ˜¯è¡¨ç¤ºåºåˆ—ä¿¡å·ï¼Œå®ƒçš„æ ¼å¼æ˜¯`ğ‘¿ = [ğ‘, sequence len, feature len]`ï¼šbä¸ªå¥å­ï¼Œsequence lenæ¯ä¸ªå¥å­å•è¯æ•°é‡ï¼Œfeature lenå•è¯ç¼–ç é•¿åº¦ã€‚

### å››ç»´å¼ é‡

å››ç»´å¼ é‡åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­åº”ç”¨éå¸¸å¹¿æ³›ï¼Œå®ƒç”¨äºä¿å­˜ç‰¹å¾å›¾(Feature maps)æ•°æ®ï¼Œæ ¼å¼ä¸€èˆ¬å®šä¹‰ä¸º[ğ‘, â„, w, ğ‘]ï¼šbå¼ å›¾ç‰‡ï¼Œhé«˜ï¼Œwå®½ï¼Œcé€šé“æ•°

### å¤šç»´å¼ é‡

æ¯”è¾ƒå°‘è§ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªç»´åº¦éƒ½æœ‰å…·ä½“å«ä¹‰ã€‚

------

## ç´¢å¼•ä¸åˆ‡ç‰‡

### ç´¢å¼•

* æ ‡å‡†ç´¢å¼•

```python
a = tf.ones([1, 5, 5, 3])

a[0][0]
a[0][0][0]
a[0][0][0][2]  => 1.0
```

* numpyç´¢å¼•é£æ ¼
```python
a = tf.randomã€‚normal([4, 28, 28, 3])	# 4å¼ 28*28çš„å½©è‰²å›¾ç‰‡

a[1].shape	=> TensorShape([28, 28, 3])
a[1, 2].shape	=> TensorShape([28, 3])
a[1, 2, 3].shape	=> TensorShape([3])
a[1, 2, 3, 2].shape	=> TensorShape([])
```

**ç´¢å¼•ç¼–å·ä»0ç«¯å¼€å§‹å°±æ˜¯æ­£å¸¸çš„0,1,2...ï¼Œä»æœ«ç«¯å¼€å§‹çš„è¯å°±æ˜¯-1,-2,-3...ï¼Œæœ€åä¸€ä¸ªæ˜¯ -1**

### åˆ‡ç‰‡

é€šè¿‡`start : end : step`åˆ‡ç‰‡æ–¹å¼å¯ä»¥æ–¹ä¾¿åœ°æå–ä¸€æ®µæ•°æ®ã€‚æ¯”å¦‚**[A:B)**ï¼Œæˆªå–ä»Aåˆ°Bï¼ˆä¸åŒ…å«Bï¼‰çš„ä¸€æ®µï¼ŒAçœç•¥æ—¶é»˜è®¤ä¸º0ï¼ŒBçœç•¥æ—¶é»˜è®¤ä¸º-1ï¼Œstepçœç•¥é»˜è®¤ä¸º1ã€‚

![image-20210805203028258](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805203028258.png)

**çœç•¥Aå’ŒBï¼Œåªæœ‰	:	è¡¨ç¤ºå…¨é€‰**

å‡è®¾a.shape = [4ï¼Œ 28ï¼Œ 28ï¼Œ 3]

![image-20210805203332666](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805203332666.png)

- a[0].shape = a[0, :, :, :].shape

![image-20210805203343376](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805203343376.png)

- a[:, :, :, 0].shape = a[:, :, :, 2].shape

![image-20210805203607385](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805203607385.png)

- å…¶ä»–åŒç†

![image-20210805203639887](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805203639887.png)

**step**

![image-20210805204139633](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805204139633.png)

**å€’åº**

```python
a = tf.range(10)
tf.Tensor([0 1 2 3 4 5 6 7 8 9], shape=(10,), dtype=int32)
```

- A:B:-1

```python
a[::-1]
<tf.Tensor: shape=(10,), dtype=int32, numpy=array([9, 8, 7, 6, 5, 4, 3, 2, 1, 0])>
    
a[2::-1]
<tf.Tensor: shape=(3,), dtype=int32, numpy=array([2, 1, 0])>
```

- A:B:-2

```python
å€’åºï¼Œéš”ç€é‡‡
a[::-2]
<tf.Tensor: shape=(5,), dtype=int32, numpy=array([9, 7, 5, 3, 1])>
```

![image-20210805204945765](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805204945765.png)

**ä¸‰ä¸ªç‚¹   ...**

ä½¿ç”¨â‹¯ç¬¦å·è¡¨ç¤ºå–å¤šä¸ªç»´åº¦ä¸Šæ‰€æœ‰çš„æ•°æ®ï¼Œå…¶ä¸­ç»´åº¦çš„æ•°é‡éœ€æ ¹æ®è§„åˆ™è‡ªåŠ¨æ¨æ–­ï¼šå½“åˆ‡ç‰‡æ–¹å¼å‡ºç°â‹¯ç¬¦å·æ—¶ï¼Œâ‹¯ç¬¦å·å·¦è¾¹çš„ç»´åº¦å°†è‡ªåŠ¨å¯¹é½åˆ°æœ€å·¦è¾¹ï¼Œâ‹¯ç¬¦å·å³è¾¹çš„ç»´åº¦å°†è‡ªåŠ¨å¯¹é½åˆ°æœ€å³è¾¹ï¼Œæ­¤æ—¶ç³»ç»Ÿå†è‡ªåŠ¨æ¨æ–­â‹¯ç¬¦å·ä»£è¡¨çš„ç»´åº¦æ•°é‡ã€‚

![image-20210805205457468](https://gitee.com/ihunzi/images/raw/master/blog/image-20210805205457468.png)

### é€‰æ‹©æ€§ç´¢å¼•

è®¾ä¸€ä¸ªtensorä¸ºï¼ša = [4, 35, 8]ï¼Œå…·ä½“å«ä¹‰æ˜¯ï¼š4ä¸ªç­çº§ï¼Œæ¯ä¸ªç­çº§35ä¸ªå­¦ç”Ÿï¼Œ 8é—¨å­¦ç§‘

`tf.gather`

```python
# data	æ•°æ®æº
# axis è¦å–å“ªä¸ªç»´åº¦
# indices å…·ä½“çš„ç´¢å¼•å·ï¼Œè‡ªå®šä¹‰
tf.gather(data, axis=0, indices=[start, end])
```

- å–2ï¼Œ3ç­çš„ä¿¡æ¯

```python
tf.gather(a, axis=0, indices=[2, 3])
# æ•°æ®æºä¸ºa
# ç¬¬ä¸€ä¸ªç»´åº¦ï¼Œç­çº§
# 2ç­ï¼Œ3ç­
TensorShape([2, 35, 8])
```

- ä¸æŒ‰é¡ºåºå–

åŸæ¥æ˜¯1ï¼Œ2ï¼Œ3ï¼Œ4ç­çš„é¡ºåºï¼Œç°åœ¨æˆ‘è¦å˜æˆ3ï¼Œ2ï¼Œ4ï¼Œ1ç­çš„é¡ºåº

```python
tf.gather(a, axis=0, indices=[2, 1, 3, 0]).shape
TensorShape([4, 35, 8])
# è™½ç„¶è¾“å‡ºçš„shapeå’ŒåŸæ¥ä¸€æ ·ï¼Œä½†æ˜¯é‡Œé¢çš„å†…å®¹é¡ºåºå·²ç»å˜äº†
```

- å–æ¯ä¸ªç­çº§çš„æŸ5ä¸ªå­¦ç”Ÿ

```python
tf.gather(a, axis=1, indices=[2, 3, 7, 9, 16]).shape
# ç»´åº¦å˜æˆ1ï¼Œç­çº§
# ç´¢å¼•ä¸ºç¬¬2ä¸ªå­¦ç”Ÿï¼Œç¬¬3ä¸ªå­¦ç”Ÿã€‚ã€‚ã€‚
TensorShape([4, 5, 8])
# è¾“å‡ºä¸º4ä¸ªç­çº§ï¼Œ5ä¸ªå­¦ç”Ÿï¼Œ8é—¨è¯¾
```

- å–å…¶ä¸­ä¸‰é—¨è¯¾çš„æ‰€æœ‰äººçš„æˆç»©

```python
tf.gather(a, axis=2, indices=[2, 3, 7]).shape
# ç»´åº¦å˜æˆ1ï¼Œç­çº§
# ç´¢å¼•ä¸ºç¬¬2é—¨è¯¾ï¼Œç¬¬3é—¨è¯¾ï¼Œç¬¬7é—¨è¯¾
TensorShape([4, 35, 3])
# è¾“å‡ºä¸º4ä¸ªç­çº§ï¼Œ35ä¸ªå­¦ç”Ÿï¼Œ3é—¨è¯¾
```

`tf.gather_nd`

ç°åœ¨è¿›è¡ŒæŠ½æ ·ï¼šç¬¬ä¸€ä¸ªç­çº§çš„ç¬¬ä¸€ä¸ªå­¦ç”Ÿï¼Œç¬¬äºŒä¸ªç­çº§çš„ç¬¬äºŒä¸ªå­¦ç”Ÿï¼Œç¬¬ä¸‰ä¸ªç­çº§çš„ç¬¬ä¸‰ä¸ªå­¦ç”Ÿï¼Œç¬¬å››ä¸ªç­çº§çš„ç¬¬å››ä¸ªå­¦ç”Ÿï¼Œå¾—åˆ°çš„è¾“å‡ºå°†ä¼šæ˜¯[4, 8]ï¼Œå››ä¸ªå­¦ç”Ÿ8é—¨è¯¾ã€‚

**æœ¬è´¨ä¸Šæ˜¯å¯¹å¤šä¸ªç»´åº¦ç´¢å¼•**

![image-20210806101059212](https://gitee.com/ihunzi/images/raw/master/blog/image-20210806101059212.png)

å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼š

```python
tf.gather_nd(a, [[0, 0], [1, 1], [2, 2], [3, 3]]).shape
# å…ˆåˆ†åˆ«å–a[0, 0], a[1, 1], a[2, 2], a[3, 3]
# ç„¶åå†ç”¨ä¸€ä¸ª[]ç»„åˆèµ·æ¥ï¼Œå°±å˜æˆäº†[4, 8]
```

`tf.boolean_mask`

ç•¥



------

## ç»´åº¦å˜æ¢

### æ”¹å˜è§†å›¾

`tf.reshape(data, new_shape)`

**ä¸¾ä¸ªä¾‹å­ï¼š[4, 28, 28, 3]ï¼Œ4å¼ 28*28çš„å½©è‰²å›¾ç‰‡ï¼Œå¯¹ä»–è¿›è¡Œä¸åŒçš„ç†è§£ï¼š**

* `a.shape = [4, 28, 28, 3]`

4å¼ å›¾ç‰‡ï¼Œé«˜28ï¼Œå®½28ï¼Œ3ä¸ªé€šé“

* `tf.reshape(a, [4, 784, 3]).shape`æˆ–è€…`tf.reshape(a, [4, -1, 3]).shape`

4å¼ å›¾ç‰‡ï¼Œ784ä¸ªåƒç´ ï¼ˆ28*28=784ï¼‰ï¼Œ3ä¸ªé€šé“

å¯¹äº-1æ¥è¯´ï¼Œç³»ç»Ÿä¼šæ ¹æ®åŸæ¥çš„ç»´åº¦ï¼Œè‡ªåŠ¨è®¡ç®—å‡º-1ã€‚**åªèƒ½æœ‰ä¸€ä¸ª-1**

- å…¶ä»–ä¾‹å­

![image-20210806104630828](https://gitee.com/ihunzi/images/raw/master/blog/image-20210806104630828.png)

![image-20210806104449738](https://gitee.com/ihunzi/images/raw/master/blog/image-20210806104449738.png)

### äº¤æ¢ç»´åº¦

äº¤æ¢ç»´åº¦æ“ä½œæ˜¯éå¸¸å¸¸è§çš„ï¼Œæ¯”å¦‚åœ¨TensorFlow ä¸­ï¼Œå›¾ç‰‡å¼ é‡çš„é»˜è®¤å­˜å‚¨æ ¼å¼æ˜¯é€šé“åè¡Œæ ¼å¼ï¼š[ğ‘, â„, w, ğ‘]ï¼Œä½†æ˜¯éƒ¨åˆ†åº“çš„å›¾ç‰‡æ ¼å¼æ˜¯é€šé“å…ˆè¡Œæ ¼å¼ï¼š[ğ‘, ğ‘, â„, w]ï¼Œå› æ­¤éœ€è¦å®Œæˆ[ğ‘, â„, w, ğ‘]åˆ°[ğ‘, ğ‘, â„, w]ç»´åº¦äº¤æ¢è¿ç®—ï¼Œæ­¤æ—¶è‹¥ç®€å•çš„ä½¿ç”¨æ”¹å˜è§†å›¾å‡½æ•°reshapeï¼Œåˆ™æ–°è§†å›¾çš„å­˜å‚¨æ–¹å¼éœ€è¦æ”¹å˜ï¼Œå› æ­¤ä½¿ç”¨æ”¹å˜è§†å›¾å‡½æ•°æ˜¯ä¸åˆæ³•çš„ã€‚æˆ‘ä»¬ä»¥[ğ‘, â„, w, ğ‘]è½¬æ¢åˆ°[ğ‘, ğ‘, â„, w]ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨`tf.transpose(x, perm)`å‡½æ•°å®Œæˆç»´åº¦äº¤æ¢æ“ä½œï¼Œå…¶ä¸­å‚æ•°permè¡¨ç¤ºæ–°ç»´åº¦çš„é¡ºåºList

è€ƒè™‘å›¾ç‰‡å¼ é‡shape ä¸º[2, 32, 32, 3]ï¼Œâ€œå›¾ç‰‡æ•°é‡ã€è¡Œã€åˆ—ã€é€šé“æ•°â€çš„ç»´åº¦**ç´¢å¼•**åˆ†åˆ«ä¸º0ã€1ã€2ã€3ï¼Œå¦‚æœéœ€è¦äº¤æ¢ä¸º[ğ‘, ğ‘, â„, w]æ ¼å¼ï¼Œåˆ™æ–°ç»´åº¦çš„æ’åºä¸ºâ€œå›¾ç‰‡æ•°é‡ã€é€šé“æ•°ã€è¡Œã€åˆ—â€ï¼Œå¯¹åº”çš„ç´¢å¼•å·ä¸º[0, 3, 1, 2]ï¼Œå› æ­¤å‚æ•°perm éœ€è®¾ç½®ä¸º[0,3,1,2]

```python
x = tf.random.normal([2,32,32,3])
tf.transpose(x,perm=[0,3,1,2]) # äº¤æ¢ç»´åº¦
<tf.Tensor: id=603, shape=(2, 3, 32, 32), dtype=float32, numpy=...>
```

å¦‚æœå¸Œæœ›å°†[ğ‘, â„, w, ğ‘]äº¤æ¢ä¸º[ğ‘, w, â„, ğ‘]ï¼Œå³å°†é«˜ã€å®½ç»´åº¦äº’æ¢ï¼Œåˆ™æ–°ç»´åº¦ç´¢å¼•ä¸º[0,2,1,3]ï¼Œ

```python
tf.transpose(x,perm=[0,2,1,3]) # äº¤æ¢ç»´åº¦
<tf.Tensor: id=612, shape=(2, 32, 32, 3), dtype=float32, numpy=...>
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡tf.transpose å®Œæˆç»´åº¦äº¤æ¢åï¼Œå¼ é‡çš„å­˜å‚¨é¡ºåºå·²ç»æ”¹å˜ï¼Œè§†å›¾ä¹Ÿéšä¹‹æ”¹å˜ï¼Œåç»­çš„æ‰€æœ‰æ“ä½œå¿…é¡»åŸºäºæ–°çš„å­˜ç»­é¡ºåºå’Œè§†å›¾è¿›è¡Œã€‚ç›¸å¯¹äºæ”¹å˜è§†å›¾æ“ä½œï¼Œç»´åº¦äº¤æ¢æ“ä½œçš„è®¡ç®—ä»£ä»·æ›´é«˜ã€‚

### å¢åŠ ç»´åº¦

é€šè¿‡`tf.expand_dims(x, axis)`å¯åœ¨æŒ‡å®šçš„axis è½´**å‰**ï¼ˆaxisä¸ºæ­£ï¼Œå¦‚æœä¸ºè´Ÿåˆ™åœ¨**å**é¢ï¼‰æ’å…¥ä¸€ä¸ªæ–°çš„ç»´åº¦

### å‡å°‘ç»´åº¦

é€šè¿‡`tf.squeeze(x, axis)`å‡½æ•°ï¼Œaxis å‚æ•°ä¸ºå¾…åˆ é™¤çš„ç»´åº¦çš„ç´¢å¼•å·ï¼Œä¾‹å¦‚ï¼Œå›¾ç‰‡æ•°é‡çš„ç»´åº¦è½´axis=0

------

## Broadcasting

![image-20210806111309284](https://gitee.com/ihunzi/images/raw/master/blog/image-20210806111309284.png)

ç”±pythonè‡ªåŠ¨å®Œæˆ



------

## æ•°å­¦è¿ç®—

### åŠ å‡ä¹˜é™¤

* `+`
* `-`
* `*`
* `/`
* `%`
* `//` æ•´é™¤

### çŸ©é˜µç›¸ä¹˜

* `@`

a@b

* `matmul`

matmul(a, b)

### æŸä¸€ç»´åº¦è¿ç®—

* reduce_mean
* reduce_max
* reduce_min
* reduce_sun

### ä¹˜æ–¹

- `tf.pow(x, a)`å¯ä»¥æ–¹ä¾¿åœ°å®Œæˆğ‘¦ = $x^ğ‘$â€‹â€‹çš„ä¹˜æ–¹è¿ç®—

- å¹³æ–¹`tf.square(x)`ï¼Œ$x^2$

### å¼€æ–¹

`tf.sqrt(x)` å¹³æ–¹æ ¹$\sqrt[]{x}$â€‹

### è‡ªç„¶æŒ‡æ•°

$e^x$ ==> `tf.exp(x)`

### å¯¹æ•°

- è‡ªç„¶å¯¹æ•°

$log_ex$â€‹  ==>  `tf.math.log(x)`

- å…¶ä»–å¯¹æ•°

å¦‚æœå¸Œæœ›è®¡ç®—å…¶å®ƒåº•æ•°çš„å¯¹æ•°ï¼Œå¯ä»¥æ ¹æ®å¯¹æ•°çš„æ¢åº•å…¬å¼ï¼š

![image-20210806113246295](https://gitee.com/ihunzi/images/raw/master/blog/image-20210806113246295.png)

ä¾‹å­ï¼š

![image-20210806113333922](https://gitee.com/ihunzi/images/raw/master/blog/image-20210806113333922.png)

```python
tf.math.log(x)/tf.math.log(10.) # æ¢åº•å…¬å¼
```

